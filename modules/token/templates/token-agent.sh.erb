#!/bin/bash
# <%= puppet_header %>
# <%=  __FILE__.gsub(/.*?puppet\//,fqdn + ':') %>
umask 077
export SSH_ASKPASS="/usr/local/bin/ssh-askpass-wrapper"
AGENT_FILE="/tmp/.token-agent-$USER"
if [ -e $AGENT_FILE ] ; then
    source $AGENT_FILE >/dev/null 2>&1
    if [ ! -e /proc/$SSH_AGENT_PID ] ; then
        ssh-agent > $AGENT_FILE 2>&1
    fi
else
    ssh-agent > $AGENT_FILE 2>&1
fi
cat $AGENT_FILE